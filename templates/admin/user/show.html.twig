{% extends 'backbase.html.twig' %}

{% block title %}User Details - {{ user.username }}{% endblock %}

{% block body %}
<div class="admin-header">
    <div class="d-flex justify-content-between align-items-center">
        <div>
            <h1 style="color: var(--admin-accent);">{{ user.username }}</h1>
            <p class="mb-0">{{ user.email }}</p>
        </div>
        <div style="display: flex; gap: 10px;">
            <a href="{{ path('admin_user_edit', {'id': user.id}) }}" class="btn-admin btn-admin-primary">
                <i class="fas fa-edit"></i> Edit
            </a>
            <a href="{{ path('admin_user_index') }}" class="btn-admin btn-admin-secondary">
                <i class="fas fa-arrow-left"></i> Back
            </a>
        </div>
    </div>
</div>

<div style="display: grid; grid-template-columns: 300px 1fr; gap: 30px; margin-top: 30px;">
    <!-- User Profile Card -->
    <div style="background: rgba(255, 255, 255, 0.03); border-radius: 15px; padding: 25px; border: 1px solid rgba(255, 255, 255, 0.1);">
        <div style="text-align: center; margin-bottom: 30px;">
            <div style="width: 100px; height: 100px; background: linear-gradient(135deg, var(--admin-accent), #007bff); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 20px; font-size: 36px; font-weight: bold; color: white;">
                {{ user.username|first|upper }}
            </div>
            <h3 style="margin-bottom: 5px;">{{ user.fullName }}</h3>
            <p style="color: #aaa; margin-bottom: 20px;">{{ user.email }}</p>
            
            <div style="display: flex; gap: 10px; justify-content: center;">
                <span class="badge-role badge-{{ user.role|lower }}" style="font-size: 1em;">
                    {{ user.role }}
                </span>
                {% if user.isActive %}
                    <span style="background: rgba(0, 255, 136, 0.1); color: var(--admin-success); padding: 4px 10px; border-radius: 12px; font-size: 0.9em;">
                        Active
                    </span>
                {% else %}
                    <span style="background: rgba(255, 45, 85, 0.1); color: var(--admin-danger); padding: 4px 10px; border-radius: 12px; font-size: 0.9em;">
                        Inactive
                    </span>
                {% endif %}
            </div>
        </div>
        
        <div style="border-top: 1px solid rgba(255, 255, 255, 0.1); padding-top: 20px;">
            <h4 style="color: var(--admin-accent); margin-bottom: 15px;">Profile Details</h4>
            
            <div style="margin-bottom: 15px;">
                <label style="display: block; color: #aaa; font-size: 0.9em; margin-bottom: 5px;">Country</label>
                <div style="color: white;">{{ user.country ?? 'Not specified' }}</div>
            </div>
            
            <div style="margin-bottom: 15px;">
                <label style="display: block; color: #aaa; font-size: 0.9em; margin-bottom: 5px;">Birth Date</label>
                <div style="color: white;">
                    {{ user.birthDate ? user.birthDate|date('Y-m-d') : 'Not specified' }}
                </div>
            </div>
            
            <div style="margin-bottom: 15px;">
                <label style="display: block; color: #aaa; font-size: 0.9em; margin-bottom: 5px;">Achievement Points</label>
                <div style="color: white; font-size: 1.2em; font-weight: bold;">
                    {{ user.achievementPoints }}
                </div>
            </div>
            
            <div style="margin-bottom: 15px;">
                <label style="display: block; color: #aaa; font-size: 0.9em; margin-bottom: 5px;">Account Created</label>
                <div style="color: white;">{{ user.createdAt|date('Y-m-d H:i:s') }}</div>
            </div>
            
            <div style="margin-bottom: 15px;">
                <label style="display: block; color: #aaa; font-size: 0.9em; margin-bottom: 5px;">Last Login</label>
                <div style="color: white;">
                    {% if user.lastLoginAt %}
                        {{ user.lastLoginAt|date('Y-m-d H:i:s') }}
                    {% else %}
                        <span style="color: #666;">Never logged in</span>
                    {% endif %}
                </div>
            </div>
        </div>
        
        <div style="border-top: 1px solid rgba(255, 255, 255, 0.1); padding-top: 20px; margin-top: 20px;">
            <h4 style="color: var(--admin-accent); margin-bottom: 15px;">Quick Actions</h4>
            
            <div style="display: flex; flex-direction: column; gap: 10px;">
                <form method="post" action="{{ path('admin_user_toggle_status', {'id': user.id}) }}" style="display: block;">
                    <input type="hidden" name="_token" value="{{ csrf_token('toggle-status' ~ user.id) }}">
                    <button type="submit" class="btn-admin {{ user.isActive ? 'btn-admin-warning' : 'btn-admin-success' }}" style="width: 100%;">
                        <i class="fas {{ user.isActive ? 'fa-user-slash' : 'fa-user-check' }}"></i>
                        {{ user.isActive ? 'Deactivate Account' : 'Activate Account' }}
                    </button>
                </form>
                
                {% if user.id != app.user.id %}
                <form method="post" action="{{ path('admin_user_delete', {'id': user.id}) }}" onsubmit="return confirm('Are you sure you want to delete this user?');" style="display: block;">
                    <input type="hidden" name="_token" value="{{ csrf_token('delete' ~ user.id) }}">
                    <button type="submit" class="btn-admin btn-admin-danger" style="width: 100%;">
                        <i class="fas fa-trash"></i> Delete Account
                    </button>
                </form>
                {% endif %}
                
                <button type="button" class="btn-admin btn-admin-secondary" style="width: 100%;" onclick="window.print()">
                    <i class="fas fa-print"></i> Print Profile
                </button>
            </div>
        </div>
    </div>
    
    <!-- Activity and Details -->
    <div>
        <!-- Activity Log -->
        <div style="background: rgba(255, 255, 255, 0.03); border-radius: 15px; padding: 25px; border: 1px solid rgba(255, 255, 255, 0.1); margin-bottom: 30px;">
            <h3 style="color: var(--admin-accent); margin-bottom: 20px;">
                <i class="fas fa-history"></i> Activity Log
            </h3>
            
            {% if activity_logs|length > 0 %}
                <div style="display: flex; flex-direction: column; gap: 15px;">
                    {% for log in activity_logs %}
                        <div style="display: flex; align-items: center; gap: 15px; padding-bottom: 15px; border-bottom: 1px solid rgba(255, 255, 255, 0.05);">
                            <div style="width: 40px; height: 40px; background: rgba(var(--admin-accent-rgb), 0.1); border-radius: 10px; display: flex; align-items: center; justify-content: center; color: var(--admin-accent);">
                                <i class="fas fa-{{ log.icon|default('circle') }}"></i>
                            </div>
                            <div style="flex: 1;">
                                <div style="font-weight: bold; color: white;">{{ log.action }}</div>
                                <div style="color: #aaa; font-size: 0.9em;">{{ log.details }}</div>
                            </div>
                            <div style="color: #666; font-size: 0.8em;">
                                {{ log.timestamp|date('Y-m-d H:i') }}
                            </div>
                        </div>
                    {% endfor %}
                </div>
            {% else %}
                <div style="text-align: center; padding: 40px; color: #666;">
                    <i class="fas fa-history" style="font-size: 2em; margin-bottom: 10px; display: block;"></i>
                    No activity recorded
                </div>
            {% endif %}
        </div>
        
        <!-- System Information -->
        <div style="background: rgba(255, 255, 255, 0.03); border-radius: 15px; padding: 25px; border: 1px solid rgba(255, 255, 255, 0.1);">
            <h3 style="color: var(--admin-accent); margin-bottom: 20px;">
                <i class="fas fa-info-circle"></i> System Information
            </h3>
            
            <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px;">
                <div>
                    <label style="display: block; color: #aaa; font-size: 0.9em; margin-bottom: 5px;">User ID</label>
                    <div style="color: white; font-family: monospace;">{{ user.id }}</div>
                </div>
                
                <div>
                    <label style="display: block; color: #aaa; font-size: 0.9em; margin-bottom: 5px;">Security Roles</label>
                    <div>
                        {% for role in user.roles %}
                            <span style="background: rgba(0, 150, 255, 0.1); color: var(--admin-accent); padding: 2px 8px; border-radius: 10px; font-size: 0.8em; margin-right: 5px; margin-bottom: 5px; display: inline-block;">
                                {{ role }}
                            </span>
                        {% endfor %}
                    </div>
                </div>
                
                <div>
                    <label style="display: block; color: #aaa; font-size: 0.9em; margin-bottom: 5px;">Email Verified</label>
                    <div style="color: var(--admin-success);">
                        <i class="fas fa-check-circle"></i> Yes
                    </div>
                </div>
                
                <div>
                    <label style="display: block; color: #aaa; font-size: 0.9em; margin-bottom: 5px;">Account Age</label>
                    <div style="color: white;">
                        {{ user.createdAt|ago }}
                    </div>
                </div>
                
                <div>
                    <label style="display: block; color: #aaa; font-size: 0.9em; margin-bottom: 5px;">Password Last Changed</label>
                    <div style="color: white;">
                        {{ user.createdAt|date('Y-m-d') }}
                    </div>
                </div>
                
                <div>
                    <label style="display: block; color: #aaa; font-size: 0.9em; margin-bottom: 5px;">Two-Factor Auth</label>
                    <div style="color: #666;">
                        <i class="fas fa-times-circle"></i> Not enabled
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}